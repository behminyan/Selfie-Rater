{"version":3,"sources":["webpack:///./src/css/main.scss","webpack:///./src/js/listeners.js","webpack:///./src/js/index.js"],"names":[],"mappings":"iCAAA,uBCAA,iBAAM,GAAc,EACpB,iBAAM,EAAa,EACnB,SAAM,EAAQ,EACd,UAAM,EAAS,EAAE,WACjB,GAAM,EAAU,EAAE,kBAClB,GAAM,EAAQ,EACd,aAAM,EAAQ,EAAE,YAChB,GAAM,EAAO,EACb,SAAM,EAAW,EACjB,aAAM,EAAS,EAEf,cAAI,EAAU,EAAO,WACrB,MAAM,EAAW,EAAQ,WAEzB,MAAM,EAAmB,UAAoB,4DAC3C,WAAQ,IAAI,EAAM,MAAO,EAAM,OAAQ,EAAO,MAAO,EACrD,WAAM,GACA,IAEN,IAEE,eACA,IAGF,OAAqB,cAAI,EAAG,EAAY,QAAK,GAAI,EAAa,OAP9D,GAOkE,EAAG,EAAG,EAAI,MAAO,EAEnF,QAAO,EAAI,UACZ,YAED,EAAM,EAAa,UAEjB,GAAM,SACN,oBAAW,UACT,GAAM,YACP,QAFD,EAIA,OAAO,SAGP,YAAW,SACX,cAAK,SACL,YAAS,SAGT,YAAM,KAAK,OACZ,IAED,EAAI,EACJ,EAAI,EACJ,GAAI,EAEJ,EAAM,EAAW,YAEf,GAAa,WAAW,UACtB,IAAM,GAAa,WAAW,EAC9B,gBACA,SACE,OACA,MAEF,OACD,GARY,EASd,IAED,EAAI,EACJ,EAAe,KACf,EACG,UAAU,UAET,GAAgB,WAAW,UAEzB,GAAQ,MAAM,QACd,UAAY,SACZ,WACA,KACD,GANe,EAOjB,IAVH,GAWG,QAAQ,UACP,MAAQ,MAAM,QACd,SAAY,YAEZ,WAEE,GAEA,gBAEF,QAEE,CACA,kBACA,gBAGA,UAAM,GAAM,GACZ,SAAI,OAAS,iBAAM,GAAkB,YAAK,EAAG,EAC7C,IAEA,QAAO,SAGP,YAAW,SACX,cAAK,SACL,YAAS,SAGT,YAAM,KACP,SACD,CACD,IAEH,GACA,EAAK,GAAG,QAAS,UACf,GAAQ,UAAU,EAAG,EAAG,EAAO,MAAO,EAEtC,UAAO,YAGP,YAAW,YACX,cAAK,YACL,YAAS,YACV,SATD,4CCjHA,gBAegC,eAE9B,OACE,KAAK,MADH,EAAQ,GACC,IAAY,OAClB,EAAM,GAAW,OAIxB,MAAO,IAAI,0BAA2B,EAAM,QAAO,EAAM,QAAO,EAAM,GAKpE,UAAO,YAEV,SA7BD,EAEA,QACA,EAEA,QACA,EAAQ,QAGF,GAGA,GAAS,EAAE,WAmBjB,EAAS,cAAc,UAAU,MAAiC,eAChE,IAAI,GACJ,KAAI,EAAc,KAElB,oBACE,QAAM,IAAI,OAGZ,mFAEA,QAAY,QAAiB,WAC3B,GAAU,EAAQ,OAAO,EAAS,WAAiC,aAAQ,EAAK,kBAAmB,EAAK,iBAAkB,EAAK,cAAe,EAC/I,qBAED,QAAK,KAAK,QACR,CACA,OACA,SACA,QAEH,UApBD,EAsBA,GAAM,GAAc,GAAI,GAAS,cAAc,QAC/C,EAAY,gBAAgB,GAC5B,EAAY,YAAY,GACxB,EAAY,gBAAgB,KAE5B,GAAM,GAAS,SAAS,eACxB,QAAM,EAAU,EAAO,WACvB,MAAM,EAAS,EAAE,cACjB,QAAY,OAEZ,GAAI,GAAe,EAEnB,EAAY,GAAG,QAAkB,WAE/B,GAAQ,UAAU,EAAG,EAAG,EAAO,MAAO,EAGtC,QACE,CADE,KAAM,KAAK,OACT,KAEF,aAAI,CAAC,EAAO,SACV,cAAO,KACP,QAMJ,YAAe,KAEf,QAAM,KAAK,QAAS,WAElB,GAAE,KACA,CACA,IA7EF,kCA8EE,YAAM,KAAK,UACT,QAAQ,MAAM,KAAK,EACnB,cAAO,EACP,aAAQ,EAEV,qBACA,4BAAU,SACT,KAAM,WACP,SACA,UAAI,GAAY,EAAS,OAAO,QAG5B,GAAC,EAAO,SACV,cACA,UAAc,EAEjB,WAGD,KACA,YAhGN,YAgGc,WAAW,EAAK,EAAG,EAAK,EAAG,EAAK,MAAO,EAC/C,UAAQ,KACR,mBAAQ,UACT,MAEJ,GAhDD,GAkDA,EAAS,MAAkB,aAAa,CAAS","file":"main.78560800.js","sourcesContent":["// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/css/main.scss\n// module id = DG0N\n// module chunks = 2","const snapWrapper = $('.snap-wrapper');\r\nconst snapButton = $('.snap');\r\nconst flash = $('.flash');\r\nconst canvas = $('.canvas')[0]; // the actual canvas DOM element\r\nconst hCanvas = $('.hidden-canvas')[0]; // the actual canvas DOM element\r\nconst dlink = $('.download');\r\nconst video = $('#myVideo')[0];\r\nconst redo = $('.redo');\r\nconst download = $('.download');\r\nconst rating = $('#ratingNum');\r\n\r\nvar context = canvas.getContext('2d');\r\nconst hContext = hCanvas.getContext('2d');\r\n\r\nconst snapCurrentFrame = (hidden = false) => {\r\n  console.log(video.width, video.height, canvas.width, canvas.height);\r\n  const dX = 110;\r\n  const dY = 80;\r\n  let ctx = context;\r\n  let cvs = canvas;\r\n  if (hidden) {\r\n    ctx = hContext;\r\n    cvs = hCanvas;\r\n  }\r\n\r\n  ctx.drawImage(video, dX, 0, cvs.width + dX - 20, cvs.height + dY, 0, 0, cvs.width, cvs.height);\r\n\r\n  return cvs.toDataURL('image/png');\r\n};\r\n\r\nconst snapSingle = () => {\r\n  // flash animation\r\n  flash.addClass('click');\r\n  setTimeout(() => {\r\n    flash.removeClass('click');\r\n  }, 200);\r\n\r\n  rating.addClass('freeze');\r\n\r\n  // animation\r\n  snapButton.addClass('inactive');\r\n  redo.addClass('active');\r\n  download.addClass('active');\r\n\r\n  // download photo\r\n  dlink.attr('href', snapCurrentFrame());\r\n};\r\n\r\nlet highestRating = 0;\r\nlet bestSnap = '';\r\nlet bestSnapId = 0;\r\n\r\nconst snapBest = () => {\r\n  // In setTimeout so as not to block thread\r\n  bestSnapId = setTimeout(() => {\r\n    const currRating = parseFloat(rating.text());\r\n    console.log(currRating, highestRating);\r\n    if (currRating >= highestRating) {\r\n      highestRating = currRating;\r\n      bestSnap = snapCurrentFrame(true); // hidden canvas\r\n    }\r\n    snapBest();\r\n  }, 100);\r\n};\r\n\r\nlet holdTimeoutId = 0;\r\nlet heldDown = false;\r\nsnapButton\r\n  .mousedown(() => {\r\n    // To be called in the future if no mouseup in time\r\n    holdTimeoutId = setTimeout(() => {\r\n      // canvas appears while button is held down\r\n      hCanvas.style.display = 'block'; \r\n      snapWrapper.addClass('pressed');\r\n      heldDown = true;\r\n      snapBest();\r\n    }, 500);\r\n  })\r\n  .mouseup(() => {\r\n    hCanvas.style.display = 'none';\r\n    snapWrapper.removeClass('pressed');\r\n    // Only execute if not held down\r\n    if (!heldDown) {\r\n      // Cancels any hold down callback\r\n      clearTimeout(holdTimeoutId);\r\n\r\n      snapSingle();\r\n    }\r\n    // End of holding down\r\n    else {\r\n      clearTimeout(bestSnapId);\r\n      rating.text(highestRating);\r\n      console.log(highestRating);\r\n\r\n      // Draw best snap onto the main canvas\r\n      const img = new Image();\r\n      img.onload = () => context.drawImage(img, 0, 0);\r\n      img.src = bestSnap;\r\n\r\n      rating.addClass('freeze');\r\n\r\n      // animation\r\n      snapButton.addClass('inactive');\r\n      redo.addClass('active');\r\n      download.addClass('active');\r\n\r\n      // download photo\r\n      dlink.attr('href', bestSnap);\r\n    }\r\n    heldDown = false;\r\n  });\r\n\r\n// redo button\r\nredo.on('click', () => {\r\n  context.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n  rating.removeClass('freeze');\r\n\r\n  // animation\r\n  snapButton.removeClass('inactive');\r\n  redo.removeClass('active');\r\n  download.removeClass('active');\r\n});\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/listeners.js","// import stylesheets\r\nrequire('../css/main.scss');\r\n\r\n// button listeners\r\nrequire('./listeners');\r\n\r\n/* global tracking */\r\nrequire('tracking/build/data/face-min');\r\n\r\nconst RATING_EXPIRY = 3000;\r\nconst BACKEND_URL = 'http://52.14.139.51/rateme';\r\nconst DETECTION_COLOR = '#FFDD1F';\r\n\r\nconst camera = $('.camera');\r\n\r\nfunction animateBorder (rating, animate) {\r\n  // border color\r\n  var color = [\r\n    Math.round(244 - 179 * rating),\r\n    Math.round(65 + 179 * rating),\r\n    60,\r\n  ];\r\n\r\n  camera.css('border', `3px solid rgb(${color[0]}, ${color[1]}, ${color[2]})`);\r\n\r\n  if (animate) {\r\n    // camera.addClass('pulse');\r\n  } else {\r\n    camera.removeClass('pulse');\r\n  }\r\n}\r\n\r\ntracking.ObjectTracker.prototype.track = function (pixels, width, height) {\r\n  var self = this;\r\n  var classifiers = this.getClassifiers();\r\n\r\n  if (!classifiers) {\r\n    throw new Error('Object classifier not specified, try `new tracking.ObjectTracker(\"face\")`.');\r\n  }\r\n\r\n  var results = [];\r\n\r\n  classifiers.forEach(function(classifier) {\r\n    results = results.concat(tracking.ViolaJones.detect(pixels, width, height, self.getInitialScale(), self.getScaleFactor(), self.getStepSize(), self.getEdgesDensity(), classifier));\r\n  });\r\n\r\n  this.emit('track', {\r\n    data: results,\r\n    pixels: pixels,\r\n    width: width,\r\n    height: height,\r\n  });\r\n};\r\n\r\nconst faceTracker = new tracking.ObjectTracker('face');\r\nfaceTracker.setInitialScale(4);\r\nfaceTracker.setStepSize(2);\r\nfaceTracker.setEdgesDensity(0.1);\r\n\r\nconst canvas = document.getElementById('face');\r\nconst context = canvas.getContext('2d');\r\nconst rating = $(\"#ratingNum\");\r\nconsole.log(rating);\r\n\r\nlet last_face_ts = 0;\r\n\r\nfaceTracker.on('track', function(event) {\r\n  // Clear rectangles\r\n  context.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n  // No face(s) found\r\n  if (event.data.length === 0) {\r\n    if (Date.now() - last_face_ts > RATING_EXPIRY) {\r\n      // Reset rating\r\n      if (!rating.hasClass('freeze')) {\r\n        rating.text('--');\r\n        animateBorder(0.5, false);\r\n      }\r\n    }\r\n  }\r\n  // Face(s) found\r\n  else {\r\n    last_face_ts = Date.now();\r\n\r\n    event.data.forEach((rect) => {\r\n      // Send for scoring\r\n      $.ajax({\r\n        url: BACKEND_URL,\r\n        type: 'POST',\r\n        data: JSON.stringify({\r\n          pixels: Array.from(event.pixels),\r\n          width: event.width,\r\n          height: event.height,\r\n        }),\r\n        contentType: 'application/json',\r\n        dataType: 'json',\r\n      }).done((response) => {\r\n        console.log(response);\r\n        var newRating = response.rating.toFixed(2);\r\n\r\n        // update rating number UI\r\n        if (!rating.hasClass('freeze')) {\r\n          rating.text(newRating);\r\n          animateBorder(response.rating, true);\r\n        }\r\n      });\r\n\r\n      // Draw face detection\r\n      context.strokeStyle = DETECTION_COLOR;\r\n      context.strokeRect(rect.x, rect.y, rect.width, rect.height);\r\n      context.font = '11px Helvetica';\r\n      context.fillStyle = '#fff';\r\n    });\r\n  }\r\n});\r\n\r\ntracking.track('#myVideo', faceTracker, {camera: true});\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/index.js"],"sourceRoot":""}